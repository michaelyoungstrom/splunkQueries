sourcetype=githublog index=testeng  | spath output=branchName path=branches{0}.name | eventstats latest(state) AS latestState BY sha,branchName,context | eventstats values(eval(if(latestState="success", context, NULL))) AS success values(eval(if(latestState="failure", context, NULL))) AS failure values(eval(if(latestState="pending", context, NULL))) AS pending BY sha,branchName | eventstats max(updated_at) AS latestTime BY sha,branchName | WHERE isnull(failure) AND isnull(pending) | table name, sha, branchName, latestTime | dedup 1 sha,branchName | WHERE sha!="null" AND branchName!="null" | JOIN sha,branchName [search index=testeng sourcetype=githublog | spath output=sha path=head_commit.id | spath output=push_time path=repository.pushed_at | eventstats latest(push_time) AS pushTime BY sha | eval branchName = ref | replace refs/heads/* WITH * IN branchName | table sha, pushTime, branchName | WHERE sha!="null"] | eval time_to_green = (strptime(latestTime, "%Y-%m-%dT%H:%M:%S.%3N%Z")-pushTime)/60 | eval _time=pushTime | timechart perc95(time_to_green) BY name
