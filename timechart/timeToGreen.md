ourcetype=githublog index=testeng | eventstats latest(state) AS latestState BY sha,context | eventstats values(eval(if(latestState="success", context, NULL))) AS success values(eval(if(latestState="failure", context, NULL))) AS failure values(eval(if(latestState="pending", context, NULL))) AS pending BY sha | eventstats latest(updated_at) AS latestTime BY sha | eventstats first(updated_at) AS firstPending BY sha | WHERE state="pending" | eval firstPending=strptime(firstPending, "%Y-%m-%dT%H:%M:%S.%3N%Z") | WHERE isnull(pending) AND isnull(failure) | JOIN sha [search index=testeng sourcetype=githublog| spath output=sha path=head_commit.id | spath output=pushTime path=repository.pushed_at | eventstats earliest(pushTime) AS pushTime BY sha | table sha, pushTime | WHERE sha !="null"] | eval time_to_green = (strptime(latestTime, "%Y-%m-%dT%H:%M:%S.%3N%Z")-pushTime)/60 | WHERE pushTime < firstPending | dedup 1 sha | eval _time=pushTime | timechart perc95(time_to_green) BY namei
