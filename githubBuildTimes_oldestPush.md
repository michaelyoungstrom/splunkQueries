sourcetype=githublog index=testeng | eventstats latest(state) AS latestState BY sha,context | eventstats values(eval(if(latestState="success", context, NULL))) AS success values(eval(if(latestState="failure", context, NULL))) AS failure values(eval(if(latestState="pending", context, NULL))) AS pending BY sha | eventstats max(updated_at) AS latestTime BY sha | JOIN sha [search index=testeng sourcetype=githublog| spath output=sha path=head_commit.id | spath output=push_time path=repository.pushed_at | eventstats first(push_time) BY sha AS push_time | table sha, push_time | WHERE sha !="null"] | eval time_to_green = (strptime(latestTime, "%Y-%m-%dT%H:%M:%S.%3N%Z")-push_time)/60 | dedup 1 sha | eval _time=push_time | timechart perc95(time_to_green) BY name| WHERE isnull(failure) AND isnull(pending)
